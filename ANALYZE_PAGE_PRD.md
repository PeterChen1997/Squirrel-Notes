# Analyze 页面重构 PRD

## 概述
重构 analyze.tsx 页面，优化用户体验和可编辑内容的管理，提供更直观的AI分析结果展示和编辑界面。

## 当前问题
1. 分类概念已被移除，但页面仍有相关代码
2. 编辑界面不够直观，用户体验待优化
3. AI分析结果展示可以更加清晰
4. 缺乏实时编辑预览

## 页面功能需求

### 1. AI 分析结果展示区域
**展示内容：**
- ✅ 分析标题 (可编辑)
- ✅ 置信度指示器 (只读)
- ✅ 建议标签列表 (可编辑)
- ✅ 关键词提取结果 (只读，但可用于标签生成)
- ❌ ~~分类信息~~ (已移除)
- ✅ 推荐学习主题 (可选择或创建新主题)

### 2. 可编辑内容列表

#### 2.5 学习主题关联（最前面展示）
- **字段名**: learningTopicId
- **类型**: 下拉选择 + 新建选项
- **默认值**: AI推荐的主题，支持编辑
- **验证规则**: 可选
- **编辑方式**: 
  - 下拉选择现有主题
  - "创建新主题"选项，弹出创建表单
  - 支持搜索过滤
  - 
#### 2.1 标题编辑
- **字段名**: title
- **类型**: 文本输入框
- **默认值**: AI生成的标题
- **验证规则**: 必填，最大200字符
- **编辑方式**: 内联编辑或独立输入框

#### 2.2 内容编辑 
- **字段名**: content
- **类型**: 多行文本区域
- **默认值**: 用户原始输入
- **验证规则**: 必填，最大5000字符
- **编辑方式**: 大型文本区域，支持自动调整高度

#### 2.3 标签编辑
- **字段名**: tags
- **类型**: 标签输入器 (支持逗号分隔或Tag输入组件，开发 tag 组件控制，或者用现有开源组件)
- **默认值**: AI建议的标签
- **验证规则**: 可选，每个标签最大50字符
- **编辑方式**: 
  - 文本输入框 (逗号分隔)
  - 或标签选择器 + 新增标签功能
  - 显示已有标签建议

#### 2.4 重要程度（不需要）
- **字段名**: importance  
- **类型**: 数值选择器 (1-5星级)
- **默认值**: 3
- **验证规则**: 1-5之间的整数
- **编辑方式**: 星级选择器或滑块



### 3. UI/UX 改进需求

#### 3.1 布局优化
- **左侧**: 原始内容展示区
- **右侧**: AI分析结果 + 编辑表单
- **响应式**: 移动端垂直堆叠

#### 3.2 实时预览
- 编辑时显示预览效果
- 标签变化实时反映
- 保存前确认界面

#### 3.3 交互改进
- 内联编辑支持 (双击编辑)
- 快捷键支持 (Ctrl/Cmd + S 保存)
- 自动保存草稿功能
- 撤销/重做功能

#### 3.4 视觉设计
- 清晰的区域分隔
- 编辑状态指示器
- 加载和保存状态反馈
- 错误提示优化

### 4. 数据流设计

#### 4.1 页面初始化
```
用户输入内容 → AI分析 → 展示分析结果 → 填充编辑表单
```

#### 4.2 编辑流程
```
用户编辑 → 实时验证 → 预览更新 → 保存确认 → 提交到服务器
```

#### 4.3 保存流程  
```
表单提交 → 标签处理 → 知识点创建 → 跳转到详情页
```

### 5. 技术实现要点

#### 5.1 状态管理
- 使用 React useState 管理编辑状态
- 区分原始值和编辑值
- 支持重置到原始状态

#### 5.2 表单验证
- 客户端实时验证
- 服务端验证确认
- 友好的错误提示

#### 5.3 标签系统集成
- 与现有标签系统无缝集成
- 支持标签自动完成
- 新标签自动创建

#### 5.4 性能优化
- 防抖输入处理
- 懒加载标签建议
- 优化重新渲染

### 6. 验收标准

#### 6.1 功能完整性
- ✅ 所有可编辑字段都能正常编辑
- ✅ AI分析结果正确展示
- ✅ 标签系统正常工作
- ✅ 主题关联功能完整

#### 6.2 用户体验
- ✅ 编辑流程直观流畅
- ✅ 响应式设计适配良好
- ✅ 加载和反馈及时
- ✅ 错误处理友好

#### 6.3 数据完整性
- ✅ 数据保存准确无误
- ✅ 标签正确创建和关联
- ✅ 主题关联正确建立

### 7. 实现优先级

#### P0 (必须实现)
1. 移除分类相关代码
2. 基本编辑功能
3. 标签系统集成
4. 保存功能修复

#### P1 (重要)  
1. UI/UX 优化
2. 表单验证
3. 响应式适配

#### P2 (可选)
1. 实时预览
2. 快捷键支持
3. 自动保存
4. 撤销/重做

---

## 总结
此重构将完全移除分类概念，专注于标签驱动的知识管理，提供更好的用户编辑体验和更清晰的AI分析结果展示。

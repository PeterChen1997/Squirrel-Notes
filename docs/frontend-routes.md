# 松鼠随记 - 前端路由文档

本文档详细梳理了"松鼠随记"应用的所有前端路由及其功能。

## 路由概览

应用采用 Remix 框架的文件系统路由，所有路由文件位于 `app/routes/` 目录下。

## 页面路由

### 1. 根路径 (/)
- **文件**: `app/routes/_index.tsx`
- **功能**: 应用首页
- **特点**:
  - 知识输入界面，支持文本和语音输入
  - Web Speech API 实时语音转文字
  - 字符限制（1000字符）
  - 示例提示内容
  - AI智能分析流程展示
  - 匿名用户和注册用户都可用

### 2. 知识库 (/knowledge)
- **文件**: `app/routes/knowledge._index.tsx`
- **功能**: 知识库管理主页
- **特点**:
  - 展示所有学习主题和知识点
  - 搜索功能（按内容搜索）
  - 筛选功能（按主题、按标签）
  - 统计信息展示
  - 创建新主题功能
  - AI概要展示和重新生成
  - 支持匿名用户浏览演示数据

### 3. 知识点详情 (/knowledge/:id)
- **文件**: `app/routes/knowledge.$id.tsx`
- **功能**: 单个知识点的详细页面
- **特点**:
  - 查看和编辑知识点内容
  - AI摘要展示
  - 标签和关键词管理
  - 相关知识点推荐
  - 学习主题关联
  - 支持修改标题、内容、标签和主题

### 4. 主题详情 (/knowledge/topic/:id)
- **文件**: `app/routes/knowledge.topic.$id.tsx`
- **功能**: 学习主题的详细页面
- **特点**:
  - 主题信息展示和编辑
  - 该主题下的所有知识点列表
  - AI概要展示（可折叠/展开）
  - 知识点快速预览和编辑
  - 统计信息展示

### 5. 登录页面 (/auth/login)
- **文件**: `app/routes/auth.login.tsx`
- **功能**: 用户登录
- **特点**:
  - 邮箱密码登录
  - 表单验证
  - 错误提示
  - 注册链接
  - 已登录用户自动重定向到首页

### 6. 注册页面 (/auth/register)
- **文件**: `app/routes/auth.register.tsx`
- **功能**: 用户注册
- **特点**:
  - 邮箱、密码、姓名注册
  - 密码确认验证
  - 匿名数据绑定提示
  - 注册成功自动登录
  - 已登录用户自动重定向到首页

### 7. 注销功能 (/auth/logout)
- **文件**: `app/routes/auth.logout.tsx`
- **功能**: 用户注销
- **特点**:
  - 清除会话cookie
  - 创建新的匿名用户
  - 重定向到首页
  - 仅支持 POST 请求

### 8. 处理进度页面 (/progress)
- **文件**: `app/routes/progress.tsx`
- **功能**: AI分析进度展示
- **特点**:
  - 动态进度条展示
  - 步骤化处理流程
  - 动画效果和背景装饰
  - AI分析结果预览
  - 自动跳转到分析页面
  - 支持单个知识点状态查询

### 9. 智能分析页面 (/analyze)
- **文件**: `app/routes/analyze.tsx`
- **功能**: AI分析结果编辑
- **特点**:
  - AI智能摘要展示
  - 原始内容对比
  - 学习主题选择（支持创建新主题）
  - 智能标签管理
  - AI推荐标签和关键词
  - 实时标签预览和编辑
  - 内容保存和重新记录

## API 路由

### 1. 重新生成概要 (/api/regenerate-overview)
- **文件**: `app/routes/api.regenerate-overview.tsx`
- **方法**: POST
- **功能**: 重新生成学习主题的AI概要
- **用途**: 知识库页面中手动触发AI概要重新生成

### 2. 知识点状态查询 (/api/knowledge/:id/status)
- **文件**: `app/routes/api.knowledge.$id.status.tsx`
- **方法**: GET
- **功能**: 查询知识点的处理状态
- **返回**: 处理状态、主题ID、标题、摘要、置信度等信息
- **用途**: 前端轮询检查AI分析进度

## 开发/工具路由

### 1. 数据初始化 (/init-data)
- **文件**: `app/routes/init-data.tsx`
- **方法**: POST
- **功能**: 创建演示数据
- **用途**: 开发和演示时创建示例学习主题和知识点

## 路由参数说明

### 动态参数
- `:id` - 知识点或主题的唯一标识符

### 查询参数
- `search` - 搜索关键词（知识库页面）
- `topic` - 主题ID筛选（知识库页面）
- `tag` - 标签名称筛选（知识库页面）
- `content` - 要分析的内容（progress页面）
- `topicId` - 主题ID（progress页面）
- `knowledgeId` - 知识点ID（progress和analyze页面）

## 路由流程

### 知识记录流程
1. 首页输入内容 → POST到首页
2. 后台保存并跳转到 `/progress?content=xxx&knowledgeId=xxx`
3. 显示进度动画，自动进行AI分析
4. 完成后跳转到 `/analyze?id=xxx`
5. 展示AI分析结果，用户可编辑并保存
6. 保存后跳转到 `/knowledge/xxx` 查看详情

### 用户认证流程
1. 访问 `/auth/login` 或 `/auth/register`
2. 提交表单进行登录/注册
3. 成功后设置会话cookie并重定向到首页
4. 访问 `/auth/logout` 注销并创建新的匿名会话

## 特殊功能

### 匿名用户支持
- 未登录用户可以体验所有功能
- 使用演示数据展示应用功能
- 注册后自动绑定之前创建的匿名数据

### AI智能分析
- 自动分析学习内容
- 生成标题、摘要、标签建议
- 推荐合适的学习主题
- 提供学习洞察和建议

### 响应式设计
- 所有页面都支持移动端适配
- 使用Tailwind CSS实现响应式布局
- 针对不同屏幕尺寸优化显示效果

## 路由守卫

### 认证检查
- 登录和注册页面会检查用户是否已登录
- 已登录用户访问这些页面会自动重定向到首页

### 权限验证
- 所有涉及数据操作的路由都会验证用户身份
- 支持注册用户和匿名用户两种模式
- 确保用户只能访问自己的数据

## 错误处理

### 404错误
- 不存在的知识点或主题会返回404错误
- 自动重定向到首页或显示友好错误信息

### API错误
- 统一的错误处理和响应格式
- 前端显示用户友好的错误提示
- 支持重试机制

---

*最后更新: 2025年1月*